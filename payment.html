<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hamsa Sarees — Confirm & Pay</title>

<meta http-equiv="Content-Security-Policy" content="
  default-src 'self' https: data: blob:;
  script-src 'self' 'unsafe-inline' https://checkout.razorpay.com https://www.gstatic.com;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src https://fonts.gstatic.com data:;
  frame-src https://checkout.razorpay.com https://api.razorpay.com;
  connect-src https://api.razorpay.com https://checkout.razorpay.com
               https://docs.google.com https://firestore.googleapis.com
               https://identitytoolkit.googleapis.com https://www.gstatic.com;
  img-src 'self' data: https: http:;
" />

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
/* ================= ROOT THEME ================= */
:root{
  --bg-main:#0a0e1a;
  --bg-panel:#11172c;
  --bg-soft:#161e3d;
  --border:rgba(255,255,255,0.08);
  --gold:#e6b566;
  --gold-dark:#cfa34e;
  --text-main:#eef2ff;
  --text-muted:#9fb0d1;
  --success:#3ddc97;
  --danger:#ff6b6b;
}

/* ================= RESET ================= */
*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui,Arial,sans-serif;
  background:
    radial-gradient(900px 400px at 20% -10%, rgba(230,181,102,.12), transparent 60%),
    linear-gradient(180deg,#080c18,#0a0e1a);
  color:var(--text-main);
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px 16px;
}
header{
  display:flex;
  align-items:center;
  gap:18px;
  padding:16px 18px;
  border-radius:16px;
  background:linear-gradient(180deg,#12183a,#0f152e);
  border:1px solid var(--border);
  box-shadow:0 20px 50px rgba(0,0,0,.45);
}
.brand{ display:flex; gap:12px; align-items:center; }
.logo{ width:48px; height:48px; border-radius:12px; overflow:hidden; }
.logo img { width: 100%; height: 100%; object-fit: cover; }
.title{ font-weight:800; font-size:16px; }
.small{ font-size:13px; color:var(--text-muted); }

/* Form Styles */
.payment-card{
  background:linear-gradient(180deg,#141c3f,#0f1533);
  border:1px solid var(--border);
  border-radius:20px;
  padding:24px;
  max-width:480px;
  margin: 40px auto;
  box-shadow:0 30px 70px rgba(0,0,0,.45);
}
h1{margin:0 0 6px;font-size:24px;font-weight:800}
.row{margin-bottom:14px}
label{display:block;font-size:13px;color:var(--text-muted);margin-bottom:6px;font-weight:600;}
input,textarea{
  width:100%;
  background:#0f1738;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  color:var(--text-main);
  font-size:14px
}
textarea{min-height:90px;resize:vertical}
.price{
  font-size:22px;
  font-weight:800;
  color:var(--gold);
  margin:8px 0 14px
}
button{
  width:100%;
  font-family:inherit;
  background:linear-gradient(90deg,var(--gold),#f3d48c);
  color:#3b2b08;
  border:none;
  padding:12px 18px;
  border-radius:14px;
  font-weight:800;
  cursor:pointer;
  box-shadow:0 10px 30px rgba(230,181,102,.35);
}
button:disabled{opacity:.6;cursor:not-allowed}
img{
  max-width:100%;
  max-height:260px;
  object-fit:cover;
  border-radius:14px;
  margin-bottom:12px;
  display:none
}
.btn-ghost{
  background:#0f1738;
  border:1px solid var(--border);
  color:var(--text-main);
  padding:9px 16px;
  border-radius:14px;
  cursor:pointer;
  text-decoration: none;
}
</style>
</head>

<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"><img src="hamsasareeslogo.jpg" alt="Hamsa Sarees Logo"></div>
      <div>
        <div class="title">Hamsa Sarees</div>
        <div class="small">Secure Checkout</div>
      </div>
    </div>
    <div style="flex:1"></div>
    <a href="index.html" class="btn-ghost">Back to Shop</a>
  </header>

  <main>
    <div class="payment-card">
      <h1>Confirm & Pay</h1>
      <div class="small" style="margin-bottom: 20px;">Please verify all details carefully</div>

      <div class="row">
        <label>Product</label>
        <input id="product" readonly />
      </div>

      <div class="row">
        <img id="productImg" alt="Product image">
      </div>

      <div class="row">
        <label>Amount</label>
        <div class="price" id="priceText">₹0</div>
      </div>

      <div class="row">
        <label>Your Name</label>
        <input id="name" required placeholder="Enter your full name" />
      </div>

      <div class="row">
        <label>Phone</label>
        <input id="phone" required placeholder="Enter your 10-digit mobile number" />
      </div>

      <div class="row">
        <label>Delivery Address</label>
        <textarea id="address" required placeholder="Enter your full delivery address"></textarea>
      </div>

      <button id="payBtn" disabled>Pay Securely</button>
    </div>
  </main>

  <footer style="text-align:center;padding:18px;color:#9fb8d9;font-size:13px;line-height:1.6;">
    ©2025 Hamsa Sarees, unauthorized use is strictly prohibited.<br>
    Website designed, created & published by Terminal Joint.
  </footer>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
/* ---------- LOAD ORDER FROM INDEX ---------- */
const raw = sessionStorage.getItem('pendingOrder');
if (!raw) {
  alert('Invalid access');
  location.href = 'index.html';
}

let order;
try { order = JSON.parse(raw); }
catch { location.href = 'index.html'; }

const productEl = document.getElementById('product');
const priceText = document.getElementById('priceText');
const nameEl = document.getElementById('name');
const phoneEl = document.getElementById('phone');
const addressEl = document.getElementById('address');
const imgEl = document.getElementById('productImg');
const payBtn = document.getElementById('payBtn');
const priceRegex = /^[1-9]\d*(\.\d+)?$/;
const price = Number(order.price);
if (!price || price <= 0) {
  alert('Invalid price');
  location.href = 'index.html';
}

productEl.value = order.product || '';
priceText.textContent = `₹${price}`;
nameEl.value = order.name || '';
phoneEl.value = order.phone || '';
addressEl.value = order.address || '';

if (order.image) {
  imgEl.src = order.image;
  imgEl.onload = () => imgEl.style.display = 'block';
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ---------- FIREBASE ---------- */
const app = initializeApp({
  apiKey: "AIzaSyBozW19Rjc9nj0YabOIE3DlW0qVHtU5XLA",
  authDomain: "hamsasarees-24738.firebaseapp.com",
  projectId: "hamsasarees-24738"
});

const auth = getAuth(app);
const db = getFirestore(app);

/* ---------- AUTH + PAY ---------- */
onAuthStateChanged(auth, user => {
  if (!user) {
    alert('Please sign in first');
    location.href = 'index.html';
    return;
  }

  payBtn.disabled = false;

  payBtn.onclick = () => {
    const name = nameEl.value.trim();
    const phone = phoneEl.value.replace(/\s+/g,'');
    const address = addressEl.value.trim();

    if (!name || !/^[6-9]\d{9}$/.test(phone) || !address || address.length < 10) {
      alert('Enter valid name, phone and full address');
      return;
    }

    payBtn.disabled = true;
    payBtn.textContent = 'Processing...';

    const rzp = new Razorpay({
      key: 'rzp_live_Rqulhc8rZRz8Iw',
      amount: Math.round(price * 100),
      currency: 'INR',
      name: 'Hamsa Sarees',
      description: order.product,

      handler: async res => {
        /* -------- FIRESTORE -------- */
        await setDoc(
          doc(db, 'users', user.uid, 'orders', crypto.randomUUID()),
          {
            product: order.product,
            price,
            name,
            phone,
            address,
            image: order.image || '',
            email: user.email,
            paymentId: res.razorpay_payment_id,
            status: 'PAID',
            createdAt: serverTimestamp()
          }
        );

        /* -------- GOOGLE FORM (MAIN ENTRY) -------- */
        const fd = new FormData();
        fd.append('entry.2120009411', name);
        fd.append('entry.6103303', phone);
        fd.append('entry.952475985', order.product);
        fd.append('entry.2008322116', address);
        fd.append('entry.135044268', price);

        fetch('https://docs.google.com/forms/d/e/1FAIpQLSfREKvTld9R59UADJQK6jxQIbM64tt1iP0M-XiPq4ykOOwe5w/formResponse', {
          method: 'POST',
          body: fd,
          mode: 'no-cors'
        });

        sessionStorage.removeItem('pendingOrder');
        alert('Payment successful!');
        location.href = 'yourorders.html';
      }
    });

    rzp.on('payment.failed', () => {
      alert('Payment failed');
      payBtn.disabled = false;
      payBtn.textContent = 'Pay Securely';
    });

    rzp.open();
  };
});
</script>

</body>
</html>
