<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hamsa Sarees</title>

<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' https://www.gstatic.com/firebasejs/ https://apis.google.com;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src 'self' https://fonts.gstatic.com;
  connect-src 'self' https://*.firebaseio.com wss://*.firebaseio.com https://www.googleapis.com https://securetoken.googleapis.com;
  img-src 'self' https: data:;
  object-src 'none';">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container">

  <!-- HEADER -->
  <header>
    <div class="brand">
      <div class="logo">HS</div>
      <div>
        <div class="title">Hamsa Sarees</div>
        <div class="small">Handpicked • Ethnic • Quality</div>
      </div>
    </div>

    <div class="actions">
      <div id="userBadge" class="user-badge"></div>
      <button id="loginBtn" class="btn-ghost">Sign in</button>
      <a href="yourorders.html" class="btn-ghost">My Orders</a>
    </div>
  </header>

  <!-- PRODUCTS -->
  <main>
    <h1>Products</h1>
    <div id="productGrid" class="grid"></div>
  </main>

</div>

<!-- LOGIN MODAL -->
<div class="modal" id="loginModal">
  <div class="modal-box modal-sm">
    <button class="close-x" id="closeLogin">✕</button>
    <h2>Sign in</h2>
    <p class="small">Sign in to place orders and view history.</p>
    <div class="mt-16">
      <button id="googleLoginBtn" class="btn btn-full">Sign in with Google</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">Saved</div>

<script type="module">
(async () => {

  /* ===============================
     FIREBASE SETUP
     =============================== */

  const firebaseConfig = {
    apiKey: "AIzaSyBozW19Rjc9nj0YabOIE3DlW0qVHtU5XLA",
    authDomain: "hamsasarees-24738.firebaseapp.com",
    projectId: "hamsasarees-24738",
    storageBucket: "hamsasarees-24738.firebasestorage.app",
    messagingSenderId: "16303342424",
    appId: "1:16303342424:web:d68d26160d45472713db2d"
  };

  const { initializeApp } =
    await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
  const { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } =
    await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
  const { getFirestore, collection, getDocs } =
    await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  const $ = id => document.getElementById(id);

  /* ===============================
     AUTH UI
     =============================== */

  onAuthStateChanged(auth, user => {
    if (user) {
      $('userBadge').style.display = 'block';
      $('userBadge').textContent = user.displayName || user.email;
      $('loginBtn').style.display = 'none';
    } else {
      $('userBadge').style.display = 'none';
      $('loginBtn').style.display = 'inline-block';
    }
  });

  $('loginBtn').addEventListener('click', () => {
    $('loginModal').classList.add('show');
  });

  $('closeLogin').addEventListener('click', () => {
    $('loginModal').classList.remove('show');
  });

  $('googleLoginBtn').addEventListener('click', async () => {
    try {
      await signInWithPopup(auth, provider);
      $('loginModal').classList.remove('show');
    } catch (e) {
      alert('Sign-in failed');
    }
  });

  /* ===============================
     LOAD PRODUCTS
     =============================== */

  const grid = $('productGrid');
  const snap = await getDocs(collection(db, 'products'));

  if (snap.empty) {
    grid.innerHTML =
      '<div class="text-muted p-16">No products available.</div>';
    return;
  }

  snap.forEach(doc => {
    const p = doc.data();
    const id = doc.id;

    const card = document.createElement('div');
    card.className = 'card';

    card.innerHTML = `
      <div class="imgwrap">
        <img src="${p.image || ''}" alt="">
      </div>
      <div class="p-12">
        <strong>${p.title}</strong>
        <div class="price mt-8">₹${p.price}</div>
        <div class="mt-12">
          <button class="btn btn-full buyBtn">Buy Now</button>
        </div>
      </div>
    `;

    card.querySelector('.buyBtn').addEventListener('click', () => {
      if (!auth.currentUser) {
        alert('Please sign in to continue');
        $('loginModal').classList.add('show');
        return;
      }
      location.href = `payment.html?pid=${id}`;
    });

    grid.appendChild(card);
  });

})();
</script>

</body>
</html>
