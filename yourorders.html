<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My Orders — Hamsa Sarees</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#001f3f; --bg2:#00306b;
  --accent:#00aaff; --accent2:#4dd0e1;
  --muted:#9fb8d9; --success:#10b981;
}
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:Inter,system-ui,Arial,sans-serif;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:#eaf6ff
}
.container{max-width:1100px;margin:20px auto;padding:0 16px}
header{
  display:flex;justify-content:space-between;align-items:center;
  background:rgba(255,255,255,0.02);
  padding:12px;border-radius:12px;margin-bottom:20px
}
.logo{
  width:44px;height:44px;border-radius:10px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex;align-items:center;justify-content:center;
  font-weight:800;color:#032033
}
.actions{display:flex;gap:8px;align-items:center}
.btn,.btn-ghost{
  padding:9px 14px;border-radius:10px;
  font-weight:700;cursor:pointer
}
.btn{
  border:none;color:#fff;
  background:linear-gradient(90deg,var(--accent),#ff5aa3)
}
.btn-ghost{
  background:transparent;border:1px solid rgba(255,255,255,.15);
  color:#fff
}
.order-card{
  background:#071522;border-radius:12px;
  padding:16px;margin-bottom:12px;
  display:flex;justify-content:space-between;gap:12px
}
.order-info strong{display:block;font-size:16px;margin-bottom:6px}
.small{font-size:14px;color:var(--muted)}
img{border-radius:8px}
.modal{
  position:fixed;inset:0;display:none;
  background:rgba(0,0,0,.6);
  align-items:center;justify-content:center
}
.modal.show{display:flex}
.modal-box{
  background:#071522;border-radius:12px;
  padding:20px;max-width:700px;width:100%
}
.toast{
  position:fixed;right:16px;bottom:16px;
  background:#0b1220;padding:10px 14px;
  border-radius:10px;border-left:4px solid var(--success);
  display:none
}
</style>
</head>

<body>

<div class="container">
  <header>
    <div style="display:flex;gap:12px;align-items:center">
      <div class="logo">HS</div>
      <div>
        <strong>Hamsa Sarees</strong><br>
        <span class="small">My Orders</span>
      </div>
    </div>
    <div class="actions">
      <span id="userBadge" class="small" style="display:none"></span>
      <button id="loginBtn" class="btn">Sign in</button>
      <button id="logoutBtn" class="btn-ghost" style="display:none">Sign out</button>
      <a href="index.html" class="btn-ghost">Back</a>
    </div>
  </header>

  <div id="ordersContainer" class="small" style="text-align:center;padding:40px">
    Please sign in to view your orders
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="orderModal">
  <div class="modal-box">
    <button id="closeModal" class="btn-ghost" style="float:right">Close</button>
    <h2>Order Details</h2>
    <pre id="orderDetails" class="small"></pre>
  </div>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBozW19Rjc9nj0YabOIE3DlW0qVHtU5XLA",
  authDomain: "hamsasarees-24738.firebaseapp.com",
  projectId: "hamsasarees-24738"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

const ordersContainer = document.getElementById('ordersContainer');
const userBadge = document.getElementById('userBadge');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const modal = document.getElementById('orderModal');
const orderDetails = document.getElementById('orderDetails');

async function loadOrders(){
  if(!auth.currentUser) return;

  ordersContainer.innerHTML = 'Loading...';

  const q = query(
    collection(db, `users/${auth.currentUser.uid}/orders`),
    orderBy('createdAt','desc')
  );
  const snap = await getDocs(q);

  if(snap.empty){
    ordersContainer.innerHTML = 'No orders yet';
    return;
  }

  ordersContainer.innerHTML = '';

  snap.forEach(d=>{
    const o = d.data();
    const card = document.createElement('div');
    card.className = 'order-card';
    card.innerHTML = `
      <div style="display:flex;gap:12px">
        ${o.image ? `<img src="${o.image}" width="70" height="90">` : ''}
        <div class="order-info">
          <strong>${o.product}</strong>
          <div class="small">${o.name}</div>
          <div class="small">₹${o.price}</div>
        </div>
      </div>
      <div>
        <button class="btn-ghost viewBtn" data-id="${d.id}">View</button>
      </div>
    `;
    ordersContainer.appendChild(card);
  });
}

ordersContainer.addEventListener('click', async e=>{
  const view = e.target.closest('.viewBtn');
  if(!view) return;

  const uid = auth.currentUser.uid;
  const id = view.dataset.id;

  const snap = await getDocs(collection(db,`users/${uid}/orders`));
  snap.forEach(d=>{
    if(d.id===id){
      const o=d.data();
      orderDetails.textContent =
`Product: ${o.product}
Price: ₹${o.price}
Name: ${o.name}
Phone: ${o.phone}
Address:
${o.address}
Payment ID:
${o.paymentId}
Status: ${o.status || 'Processing'}`;
      modal.classList.add('show');
    }
  });
});

document.getElementById('closeModal').onclick=()=>modal.classList.remove('show');
loginBtn.onclick=()=>signInWithPopup(auth,provider);
logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
  if(user){
    userBadge.style.display='inline';
    userBadge.textContent=user.email;
    loginBtn.style.display='none';
    logoutBtn.style.display='inline';
    loadOrders();
  }else{
    ordersContainer.innerHTML='Please sign in to view your orders';
    userBadge.style.display='none';
    loginBtn.style.display='inline';
    logoutBtn.style.display='none';
  }
});
</script>

</body>
</html>
