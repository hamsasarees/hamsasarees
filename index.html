<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hamsa Sarees</title>

<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://www.gstatic.com https://apis.google.com https://accounts.google.com;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src https://fonts.gstatic.com;
  connect-src
    https://www.googleapis.com
    https://firestore.googleapis.com
    https://securetoken.googleapis.com
    https://identitytoolkit.googleapis.com
    https://www.gstatic.com;
  frame-src https://accounts.google.com;
  img-src 'self' https: data:;
">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

<style>
body { font-family: Inter; background:#0d1117; color:#e6edf3; margin:0 }
.container { max-width:900px; margin:auto; padding:20px }
.btn { padding:8px 14px; background:#238636; color:#fff; border:none; cursor:pointer }
.btn-ghost { background:none; border:1px solid #444; color:#ccc }
.card { background:#161b22; padding:14px; border-radius:8px; margin-bottom:12px }
.hidden { display:none }
</style>
</head>

<body>
<div class="container">

<h2>Hamsa Sarees</h2>

<div id="authBar">
  <button id="loginBtn" class="btn">Sign in</button>
  <button id="logoutBtn" class="btn-ghost hidden">Sign out</button>
  <span id="userInfo"></span>
</div>

<hr>

<div id="adminPanel" class="card hidden">
  <h3>Admin Panel</h3>
  <input id="pName" placeholder="Product name"><br><br>
  <input id="pPrice" type="number" placeholder="Price"><br><br>
  <button id="addBtn" class="btn">Add Product</button>
</div>

<h3>Products</h3>
<div id="products"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const ADMIN_UID = "EenXHJIvZpavhkGTCI8EZyFAfH93";

const firebaseConfig = {
  apiKey: "AIzaSyBozW19Rjc9nj0YabOIE3DlW0qVHtU5XLA",
  authDomain: "hamsasarees-24738.firebaseapp.com",
  projectId: "hamsasarees-24738"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const adminPanel = document.getElementById("adminPanel");
const productsDiv = document.getElementById("products");
const userInfo = document.getElementById("userInfo");

loginBtn.onclick = () => signInWithPopup(auth, provider);
logoutBtn.onclick = () => signOut(auth);

onAuthStateChanged(auth, user => {
  if (!user) {
    adminPanel.classList.add("hidden");
    loginBtn.classList.remove("hidden");
    logoutBtn.classList.add("hidden");
    userInfo.textContent = "";
    return;
  }

  userInfo.textContent = user.email;
  loginBtn.classList.add("hidden");
  logoutBtn.classList.remove("hidden");

  if (user.uid === ADMIN_UID) {
    adminPanel.classList.remove("hidden");
  }

  loadProducts();
});

async function loadProducts() {
  productsDiv.innerHTML = "";
  const snap = await getDocs(collection(db, "products"));
  snap.forEach(d => {
    const p = d.data();
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <b>${p.name}</b> — ₹${p.price}
      ${auth.currentUser?.uid === ADMIN_UID ? `<button data-id="${d.id}" class="del btn-ghost">Delete</button>` : ""}
    `;
    productsDiv.appendChild(div);
  });

  document.querySelectorAll(".del").forEach(b => {
    b.onclick = async () => {
      await deleteDoc(doc(db, "products", b.dataset.id));
      loadProducts();
    };
  });
}

document.getElementById("addBtn").onclick = async () => {
  const name = pName.value.trim();
  const price = Number(pPrice.value);
  if (!name || !price) return alert("Missing");
  await addDoc(collection(db, "products"), { name, price });
  pName.value = pPrice.value = "";
  loadProducts();
};
</script>

</body>
</html>
