<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hamsa Sarees — Payment</title>

  <!-- ✅ WORKING CSP FOR RAZORPAY + GOOGLE FONTS + INLINE SCRIPT -->
  <!-- Razorpay REQUIRES inline JS + api.razorpay.com iframe -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' https: data: blob:;
    script-src 'self' 'unsafe-inline' https://checkout.razorpay.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com data:;
    frame-src https://checkout.razorpay.com https://api.razorpay.com;
    connect-src https://api.razorpay.com https://checkout.razorpay.com;
    img-src 'self' data: https:;
  " />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#001f3f,#00306b);color:#eaf6ff;display:flex;align-items:center;justify-content:center;min-height:100vh}
    .card{background:linear-gradient(180deg,#071522,#06121a);border-radius:14px;padding:24px;max-width:420px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.45);border:1px solid rgba(255,255,255,0.05)}
    h1{margin:0 0 6px;font-size:22px;font-weight:800}
    .small{color:#9fb8d9;font-size:14px;margin-bottom:14px}
    .row{margin-bottom:12px}
    label{display:block;font-size:13px;color:#9fb8d9;margin-bottom:6px}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#0b1220;color:#fff;font-size:14px}
    input:read-only{opacity:.7}
    .price{font-size:20px;font-weight:800;color:#4dd0e1;margin:8px 0 14px}
    button{width:100%;padding:14px;border-radius:12px;border:none;background:linear-gradient(90deg,#00aaff,#ff5aa3);color:#fff;font-weight:800;font-size:15px;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    footer{margin-top:14px;text-align:center;font-size:12px;color:#9fb8d9}
  </style>
</head>
<body>

  <div class="card">
    <h1>Secure Payment</h1>
    <div class="small">Powered by Razorpay</div>

    <div class="row">
      <label>Product</label>
      <input id="product" readonly />
    </div>

    <div class="row">
      <label>Amount</label>
      <div class="price" id="priceText">₹0</div>
    </div>

    <div class="row">
      <label>Your Name</label>
      <input id="name" />
    </div>

    <div class="row">
      <label>Email</label>
      <input id="email" type="email" placeholder="optional" />
    </div>

    <div class="row">
      <label>Phone</label>
      <input id="phone" />
    </div>

    <button id="payBtn">Pay Now</button>

    <footer>Do not refresh during payment</footer>
  </div>

  <!-- Razorpay checkout -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <script>
    // ---- READ DATA FROM MAIN PAGE ----
    const params = new URLSearchParams(window.location.search);
    const product = params.get('product') || '';
    const price = Number(params.get('price'));
    const nameParam = params.get('name') || '';
    const phoneParam = params.get('phone') || '';

    const productEl = document.getElementById('product');
    const priceText = document.getElementById('priceText');
    const nameEl = document.getElementById('name');
    const phoneEl = document.getElementById('phone');
    const emailEl = document.getElementById('email');
    const payBtn = document.getElementById('payBtn');

    if (!price || isNaN(price) || price <= 0) {
      alert('Invalid payment link. Please place order again.');
      payBtn.disabled = true;
    } else {
      priceText.innerText = '₹' + price;
    }

    productEl.value = product;
    nameEl.value = nameParam;
    phoneEl.value = phoneParam;

    payBtn.onclick = function () {
      const amountPaise = Math.round(price * 100);
      payBtn.disabled = true;

      const options = {
        key: 'rzp_live_Rqulhc8rZRz8Iw',
        amount: amountPaise,
        currency: 'INR',
        name: 'Hamsa Sarees',
        description: product || 'Order Payment',
        handler: function (response) {
          alert('Payment successful!
Payment ID: ' + response.razorpay_payment_id);

          // ---- SEND ORDER TO GOOGLE FORM AFTER PAYMENT ----
          const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSfREKvTld9R59UADJQK6jxQIbM64tt1iP0M-XiPq4ykOOwe5w/formResponse';
          const fd = new FormData();

          fd.append('entry.1128392407', nameEl.value || '');      // Name
          fd.append('entry.654904844', params.get('address') || ''); // Address
          fd.append('entry.1644126654', phoneEl.value || '');     // Phone
          fd.append('entry.1866699911', product || '');           // Product

          fetch(formUrl, { method: 'POST', body: fd, mode: 'no-cors' })
            .then(() => console.log('Order sent to Google Sheet'))
            .catch(err => console.error('Sheet error', err));
        },
        prefill: {
          name: nameEl.value,
          email: emailEl.value,
          contact: phoneEl.value
        },
        theme: { color: '#00aaff' }
      };

      const rzp = new Razorpay(options);
      rzp.on('payment.failed', function (resp) {
        alert('Payment failed: ' + resp.error.description);
        payBtn.disabled = false;
      });
      rzp.open();
    };
  </script>
</body>
</html>
