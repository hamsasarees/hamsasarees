<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hamsa Sarees - Online Shop</title>
<style>
  body { margin:0; font-family:Arial, sans-serif; background:#f5f5f5; }
  header { background:#222; color:#fff; padding:15px; text-align:center; font-size:22px; font-weight:bold; display:flex; align-items:center; justify-content:space-between; gap:12px; }
  .header-left { flex:1; text-align:center; }
  .header-right { color:#fff; padding-right:12px; font-size:14px; display:flex; align-items:center; gap:8px; }
  .container { max-width:1000px; margin:auto; padding:15px; }
  .product-card { background:#fff; border-radius:12px; padding:15px; box-shadow:0 0 8px rgba(0,0,0,0.1); margin-bottom:22px; }
  .product-img { width:100%; height:300px; background:#ddd; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:18px; color:#555; }
  .product-title { font-size:20px; font-weight:bold; margin-top:12px; }
  .price { font-size:18px; color:green; margin:8px 0; }
  .order-btn { width:100%; padding:12px; background:#e91e63; color:white; border:none; border-radius:8px; font-size:18px; cursor:pointer; }
  .order-btn:hover { background:#c2185b; }

  /* LOGIN MODAL (Google only) */
  #loginModal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.7); z-index:100000; }
  #loginBox { background:white; padding:20px; border-radius:12px; width:95%; max-width:420px; box-shadow:0 0 20px rgba(0,0,0,0.4); text-align:center }
  #loginBox h2 { margin:0 0 12px 0; }
  .btn { padding:10px; border-radius:8px; border:none; cursor:pointer; font-size:16px; }
  #googleBtn { background:#fff; color:#444; border:1px solid #ddd; display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 16px; }
  #loginErr { color:red; text-align:center; margin-top:10px; display:none; word-break:break-word; }
  #userBadge { background:#fff3; padding:6px 10px; border-radius:6px; font-size:14px }

  /* ORDER FORM POPUP */
  #confirmDialog { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:99999; justify-content:center; align-items:center; padding:20px; }
  #dialogBox { background:white; padding:20px; border-radius:12px; width:95%; max-width:400px; box-shadow:0 0 10px rgba(0,0,0,0.3); }
  #dialogBox h2 { text-align:center; margin-bottom:12px; }
  input, textarea { width:100%; padding:10px; margin-bottom:12px; border:1px solid #ccc; border-radius:8px; font-size:16px; }
  #submitBtn { background:green; color:white; padding:12px; width:100%; border:none; border-radius:8px; font-size:18px; }
  #cancelBtn { background:#777; color:white; padding:10px; width:100%; border:none; border-radius:8px; font-size:16px; margin-top:8px; }
  #successMsg { display:none; color:green; font-size:18px; text-align:center; margin-top:10px; }
  @media(max-width:600px){ .product-img { height:200px; } }
</style>
</head>
<body>

<header>
  <div class="header-left">Hamsa Sarees - Online Shop</div>
  <div class="header-right" id="userArea">
    <span id="userName" style="display:none; font-weight:600"></span>
    <button id="signOutBtn" style="display:none; margin-left:10px; background:#ff5252; color:white; border:none; padding:8px 10px; border-radius:8px; cursor:pointer;">Sign Out</button>
  </div>
</header>

<div class="container">

  <!-- PRODUCT 1 -->
  <div class="product-card">
    <div class="product-img" id="img1">Upload Image Here</div>
    <div class="product-title">Beautiful Saree</div>
    <div class="price">₹1499</div>
    <button class="order-btn" onclick="openOrder('Beautiful Saree')">Order Now</button>
  </div>

  <!-- PRODUCT 2 -->
  <div class="product-card">
    <div class="product-img" id="img2">Upload Image Here</div>
    <div class="product-title">Designer Saree</div>
    <div class="price">₹1799</div>
    <button class="order-btn" onclick="openOrder('Designer Saree')">Order Now</button>
  </div>

</div>

<!-- ORDER POPUP -->
<div id="confirmDialog">
  <div id="dialogBox">
    <h2>Confirm Your Order</h2>
    <p id="selectedProduct" style="font-size:16px; text-align:center; margin-bottom:15px;"></p>

    <form id="orderForm" method="POST" action="https://docs.google.com/forms/d/e/1FAIpQLSfREKvTld9R59UADJQK6jxQIbM64tt1iP0M-XiPq4ykOOwe5w/formResponse" target="hiddenFrame" onsubmit="submitForm(event)">
      <input type="text" name="entry.1128392407" placeholder="Your Name" required />
      <textarea name="entry.654904844" placeholder="Address" required></textarea>
      <input type="tel" name="entry.1644126654" placeholder="Mobile Number" required />
      <input type="text" id="productField" name="entry.1866699911" readonly />
      <button id="submitBtn">Place Order</button>
    </form>

    <button id="cancelBtn" onclick="closeOrder()">Cancel</button>
    <div id="successMsg">Your order placed successfully!</div>
  </div>
</div>

<iframe name="hiddenFrame" style="display:none;"></iframe>

<!-- LOGIN MODAL (Google only) -->
<div id="loginModal">
  <div id="loginBox">
    <h2>Sign in with Google to continue</h2>
    <p style="color:#666; margin-bottom:12px;">Tap the button below — no typing needed.</p>
    <button class="btn" id="googleBtn" aria-label="Sign in with Google"> <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 48 48'><path fill='%23EA4335' d='M24 9.5c3.9 0 7.3 1.3 10 3.6l7.3-7.3C36.6 2 30.8 0 24 0 14.7 0 6.9 4.7 2.7 11.5l8.9 6.9C13.7 13.2 18.3 9.5 24 9.5z'/><path fill='%234285F4' d='M46.5 24.5c0-1.6-.1-3.1-.4-4.6H24v9.1h12.6c-.5 2.7-2 5-4.3 6.6l6.9 5.3c4-3.7 6.3-9 6.3-16.4z'/><path fill='%23FBBC05' d='M9.6 28.4c-1.1-3.2-1.1-6.6 0-9.8L.7 12.8C-2.7 17.7-2.7 30.3.7 35.2l8.9-6.8z'/><path fill='%2340A057' d='M24 48c6.6 0 12.2-2.2 16.3-6l-6.9-5.3c-3 2-6.9 3.1-9.4 3.1-5.7 0-10.3-3.7-12.4-8.6l-8.9 6.9C6.9 43.3 14.7 48 24 48z'/></svg>' alt='G' style='vertical-align:middle'/> Sign in with Google</button>
    <div id="loginErr"></div>
    <p style="margin-top:12px; font-size:13px; color:#666;">If popup is blocked, allow popups for this site or try again.</p>
  </div>
</div>

<script>
// UI helpers and order control
let selectedProduct = '';
function openOrder(product){
  // ensure user is signed in
  if(!window.currentUser){
    // show login modal if not signed in
    document.getElementById('loginModal').style.display = 'flex';
    document.getElementById('loginErr').innerText = 'Please sign in with Google to place an order.';
    document.getElementById('loginErr').style.display = 'block';
    return;
  }
  selectedProduct = product;
  document.getElementById('productField').value = product;
  document.getElementById('selectedProduct').innerText = "You are ordering: " + product;
  document.getElementById('confirmDialog').style.display = 'flex';
  document.getElementById('successMsg').style.display = 'none';
}
function closeOrder(){
  document.getElementById('confirmDialog').style.display = 'none';
}
function submitForm(event){
  event.preventDefault();
  const form = document.getElementById('orderForm');
  form.submit();
  document.getElementById('successMsg').style.display = 'block';
  form.reset();
  setTimeout(closeOrder, 3000);
}
</script>

<script type="module">
  document.addEventListener('DOMContentLoaded', async () => {
    try{
      const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
      const { getAuth, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
      const { getFirestore } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
      const { getStorage } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js');

      const firebaseConfig = {
        apiKey: "AIzaSyBozW19Rjc9nj0YabOIE3DlW0qVHtU5XLA",
        authDomain: "hamsasarees-24738.firebaseapp.com",
        projectId: "hamsasarees-24738",
        storageBucket: "hamsasarees-24738.firebasestorage.app",
        messagingSenderId: "16303342424",
        appId: "1:16303342424:web:d68d26160d45472713db2d",
        measurementId: "G-1G1HQGJ5XS"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const storage = getStorage(app);
      const provider = new GoogleAuthProvider();

      // cache DOM elements safely after DOMContentLoaded
      const googleBtn = document.getElementById('googleBtn');
      const loginModal = document.getElementById('loginModal');
      const loginErr = document.getElementById('loginErr');
      const signOutBtn = document.getElementById('signOutBtn');
      const userName = document.getElementById('userName');

      window.currentUser = null;

      // Process redirect result (if redirected back)
      try{
        const redirectResult = await getRedirectResult(auth);
        if(redirectResult && redirectResult.user){
          console.log('Redirect sign-in success', redirectResult.user);
        }
      }catch(rr){
        console.warn('getRedirectResult no-op or failed', rr && rr.code);
      }

      if(googleBtn){
        googleBtn.addEventListener('click', async (evt) => {
          loginErr.style.display = 'none';
          try{
            // Try popup sign-in first
            const result = await signInWithPopup(auth, provider);
            console.log('Google sign-in success', result.user);
          }catch(e){
            console.error('Google sign-in error', e && e.code, e && e.message);
            // If popup related, fall back to redirect
            const popupErrors = ['auth/popup-blocked','auth/popup-closed-by-user','auth/cancelled-popup-request'];
            if(popupErrors.includes(e.code)){
              try{
                console.log('Falling back to signInWithRedirect');
                await signInWithRedirect(auth, provider);
                return;
              }catch(err){
                console.error('Redirect fallback failed', err && err.code, err && err.message);
                loginErr.innerText = 'Popup blocked and redirect failed. Allow popups or try another browser.';
                loginErr.style.display = 'block';
                return;
              }
            }
            if(e.code === 'auth/unauthorized-domain'){
              loginErr.innerText = 'Domain not authorized. Add your GitHub Pages domain in Firebase console → Authentication → Authorized domains.';
            } else {
              loginErr.innerText = e.message || 'Google sign-in failed';
            }
            loginErr.style.display = 'block';
          }
        });
      } else {
        console.warn('googleBtn not found');
      }

      if(signOutBtn){
        signOutBtn.addEventListener('click', async () => {
          try{ await signOut(auth); }catch(e){ console.error('signOut failed', e); }
        });
      }

      onAuthStateChanged(auth, (user) => {
        window.currentUser = user;
        if(user){
          loginModal.style.display = 'none';
          userName.style.display = 'inline-block';
          userName.innerText = 'Signed in as ' + (user.displayName || user.email || 'User');
          signOutBtn.style.display = 'inline-block';
        } else {
          loginModal.style.display = 'flex';
          userName.style.display = 'none';
          signOutBtn.style.display = 'none';
        }
      });

      // ensure modal shows on load if user not signed in
      if(!auth.currentUser){ loginModal.style.display = 'flex'; }

    }catch(globalErr){
      console.error('Firebase init or DOM setup failed', globalErr);
      const loginErr = document.getElementById('loginErr');
      if(loginErr){ loginErr.innerText = 'Initialization failed. Check console for details.'; loginErr.style.display = 'block'; }
    }
  });
</script>

</body>
</html>
