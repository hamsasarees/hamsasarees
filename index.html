<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hamsa Sarees — Boutique</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#e91e63;--glass:rgba(255,255,255,0.04);
  --glass-2:rgba(255,255,255,0.03);--success:#10b981
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#071023 0%, #071a2a 60%);color:#e6eef8;}
.container{max-width:1200px;margin:28px auto;padding:0 20px}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:18px 20px;background:transparent}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,#ff7ab6,#ff6a9a);display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff}
.title{font-weight:800;font-size:20px;color:#fff}
.search{display:flex;align-items:center;background:var(--glass);padding:8px;border-radius:10px;gap:8px}
.search input{background:transparent;border:none;color:#e6eef8;outline:none;width:240px}
.actions{display:flex;gap:10px;align-items:center}
.btn{cursor:pointer;border-radius:10px;padding:8px 12px;border:none;font-weight:700;background:linear-gradient(90deg,var(--accent),#ff5aa3);color:#fff;box-shadow:0 6px 18px rgba(233,30,99,0.18)}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff;padding:8px 10px;border-radius:10px}
.header-note{font-size:13px;color:var(--muted)}
.hero{display:flex;gap:24px;align-items:center;margin-top:10px}
.hero-card{flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:22px;border-radius:16px;backdrop-filter: blur(6px);box-shadow:0 10px 30px rgba(2,6,23,0.6)}
.hero h1{margin:0;font-size:28px;color:#fff}
.hero p{color:var(--muted);margin-top:8px}
.hero-cta{display:flex;gap:12px;margin-top:18px}
.promo{width:320px;padding:18px;border-radius:14px;background:linear-gradient(135deg,#071a2a,#0f2430);box-shadow:0 10px 40px rgba(2,6,23,0.6)}
.promo strong{display:block;color:#fff}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:22px}
.card{background:linear-gradient(180deg,#071728,#081622);padding:14px;border-radius:14px;transition:transform .25s, box-shadow .25s;position:relative;overflow:hidden}
.card:hover{transform:translateY(-8px);box-shadow:0 20px 40px rgba(2,6,23,0.6)}
.imgwrap{height:220px;border-radius:10px;background:linear-gradient(180deg,#071b28,#08212b);display:flex;align-items:center;justify-content:center;color:#8aa0bb;font-weight:700;position:relative;overflow:hidden}
.imgwrap img{max-width:100%;height:100%;object-fit:cover}
.card h3{margin:12px 0 6px;font-size:18px;color:#fff}
.price{color:#34d399;font-weight:800}
.card .meta{display:flex;align-items:center;justify-content:space-between;gap:8px}
.card .orderBtn{width:100%;margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#ff5aa3);border:none;font-weight:800;cursor:pointer}
.stars{color:#fbbf24}
/* small interactive tag */
.tag{position:absolute;top:12px;left:12px;background:#00000044;padding:6px 8px;border-radius:8px;font-size:13px}
/* modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(2,6,23,0.6),rgba(2,6,23,0.8));z-index:1200;padding:20px}
.modal-box{max-width:720px;width:100%;background:linear-gradient(180deg,#071522,#06121a);border-radius:12px;padding:18px;color:#e6eef8;position:relative;box-shadow:0 30px 80px rgba(2,6,23,0.6)}
.modal-box h2{margin:0;font-size:20px}
.field{display:flex;flex-direction:column;margin-top:12px}
.field input,.field textarea,select{padding:12px;border-radius:10px;border:none;background:#08121a;color:#dbeafe}
.small{color:var(--muted)}
.modal-footer{display:flex;gap:10px;align-items:center;margin-top:12px}
.close-x{position:absolute;top:12px;right:12px;background:transparent;border:none;color:#ff6b6b;font-weight:800;font-size:18px;cursor:pointer}
.toast{position:fixed;right:24px;bottom:24px;background:#0b1220;padding:12px 16px;border-radius:12px;color:#d1fae5;border-left:4px solid var(--success);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
.orders-list{max-height:320px;overflow:auto;border-radius:10px;padding:10px;background:linear-gradient(180deg,#06131a,#071722)}
/* responsive */
@media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}.promo{display:none}}
@media(max-width:640px){.grid{grid-template-columns:1fr}.search input{width:120px}}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">HS</div>
    <div>
      <div class="title">Hamsa Sarees</div>
      <div class="header-note">Handpicked · Ethnic · Quality</div>
    </div>
  </div>
  <div class="search" role="search">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#9fb6c9" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
    <input id="searchBox" placeholder="Search sarees, cotton, silk..." />
  </div>
  <div class="actions">
    <div id="userBadge" style="display:none;background:var(--glass);padding:8px 10px;border-radius:10px;color:#fff;font-weight:700"></div>
    <button id="myOrdersBtn" class="btn-ghost" style="display:none">My Orders</button>
    <button id="signOutBtn" class="btn-ghost" style="display:none">Sign out</button>
    <button id="loginShowBtn" class="btn">Sign in</button>
  </div>
</header>
<main class="container">
  <section class="hero">
    <div class="hero-card">
      <h1>Real sarees. Real people. Real style.</h1>
      <p class="small">Browse our curated collection. Sign in to place orders—saved to your account. Smooth checkout included.</p>
      <div class="hero-cta">
        <button id="shopNow" class="btn">Shop Now</button>
        <button id="exploreBtn" class="btn-ghost">Collections</button>
      </div>
    </div>
    <aside class="promo">
      <strong>Limited Offer</strong>
      <div class="small" style="margin-top:8px">Free shipping on orders above ₹3000</div>
      <div style="margin-top:14px;font-weight:800;color:#34d399">Best Seller: Elegant Cotton — ₹1499</div>
    </aside>
  </section>

  <section>
    <div style="display:flex;align-items:center;justify-content:space-between">
      <h2 style="margin:22px 0 0">Products</h2>
      <div class="small" style="margin-top:22px">Signed-in users can place orders; orders saved to your account</div>
    </div>

    <div class="grid" id="productGrid">
      <div class="card">
        <div class="tag">New</div>
        <div class="imgwrap" id="img1"><img src="https://images.unsplash.com/photo-1520975918016-4d0b5b0b2f3d?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder" alt="Beautiful Saree"/></div>
        <h3>Beautiful Saree</h3>
        <div class="meta"><div class="price">₹1499</div><div class="stars">★★★★☆</div></div>
        <div class="card-foot"><button class="orderBtn" data-product="Beautiful Saree">Order Now</button></div>
      </div>

      <div class="card">
        <div class="imgwrap" id="img2"><img src="https://images.unsplash.com/photo-1541099649105-f69ad21f3246?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder" alt="Designer Saree"/></div>
        <h3>Designer Saree</h3>
        <div class="meta"><div class="price">₹1799</div><div class="stars">★★★★★</div></div>
        <div class="card-foot"><button class="orderBtn" data-product="Designer Saree">Order Now</button></div>
      </div>

      <div class="card">
        <div class="imgwrap"><img src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder" alt="Silk Blend"/></div>
        <h3>Silk Blend Saree</h3>
        <div class="meta"><div class="price">₹2199</div><div class="stars">★★★★☆</div></div>
        <div class="card-foot"><button class="orderBtn" data-product="Silk Blend Saree">Order Now</button></div>
      </div>
    </div>
  </section>
</main>

<!-- Order Modal -->
<div class="modal" id="orderModal">
  <div class="modal-box">
    <button class="close-x" id="closeOrderModal">✕</button>
    <h2>Confirm Your Order</h2>
    <p class="small" id="selectedProduct"> </p>
    <form id="orderForm" method="POST" action="https://docs.google.com/forms/d/e/1FAIpQLSfREKvTld9R59UADJQK6jxQIbM64tt1iP0M-XiPq4ykOOwe5w/formResponse" target="hiddenFrame">
      <div class="field"><input id="custName" name="entry.1128392407" placeholder="Your Name" required></div>
      <div class="field"><textarea id="custAddress" name="entry.654904844" placeholder="Address" required></textarea></div>
      <div class="field"><input id="custPhone" name="entry.1644126654" placeholder="Mobile Number" required></div>
      <div class="field"><input id="productField" name="entry.1866699911" readonly></div>
      <div class="modal-footer">
        <button class="btn" id="placeOrder">Place Your Order</button>
        <button type="button" class="btn-ghost" id="cancelOrder">Cancel</button>
      </div>
    </form>
    <div id="orderStatus" class="small" style="margin-top:10px;color:var(--success);display:none">Order placed. Thank you!</div>
  </div>
</div>

<!-- Login Modal -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <button class="close-x" id="closeLogin">✕</button>
    <h2>Sign in</h2>
    <p class="small">Use Google to sign in. No typing required.</p>
    <div style="display:flex;gap:12px;justify-content:center;margin-top:12px">
      <button id="googleBtnLarge" class="btn">Sign in with Google</button>
    </div>
    <p id="loginErr" class="small" style="margin-top:12px;color:#ffb4b4;display:none"></p>
    <p class="small" style="margin-top:10px">If popup is blocked, allow popups or try again in a new tab.</p>
  </div>
</div>

<!-- Payment Modal -->
<div class="modal" id="paymentModal">
  <div class="modal-box">
    <button class="close-x" id="closePayment">✕</button>
    <h2>Payment</h2>
    <p class="small" id="paymentSummary" style="margin-top:8px"></p>
    <div style="margin-top:12px;display:flex;gap:10px;flex-direction:column">
      <label class="small">Select Payment Method</label>
      <select id="paymentMethod" style="padding:12px;border-radius:10px;border:none;background:#08121a;color:#dbeafe">
        <option value="card">Card (Test)</option>
        <option value="upi">UPI (Test)</option>
        <option value="cod">Cash on Delivery</option>
      </select>
      <button class="btn" id="payNow">Pay Now</button>
    </div>
    <div id="paymentMsg" class="small" style="margin-top:10px;color:var(--success);display:none">Payment successful. Finalizing order...</div>
  </div>
</div>

<!-- My Orders Modal -->
<div class="modal" id="myOrdersModal">
  <div class="modal-box">
    <button class="close-x" id="closeMyOrdersX">✕</button>
    <h2>My Orders</h2>
    <div class="orders-list" id="ordersList"></div>
    <div style="display:flex;gap:10px;margin-top:12px"><button id="closeOrders" class="btn-ghost">Close</button></div>
  </div>
</div>

<iframe name="hiddenFrame" style="display:none"></iframe>

<div id="toast" class="toast" style="display:none">Saved.</div>

<footer style="max-width:1200px;margin:40px auto 80px;padding:0 20px;color:var(--muted)">© Hamsa Sarees • Boutique experience</footer>

<script type="module">
document.addEventListener('DOMContentLoaded', async () => {
  // dynamic Firebase import and setup
  try{
    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
    const { getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, signOut, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
    const { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, getDocs } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');

    const firebaseConfig = {
      apiKey: "AIzaSyBozW19Rjc9nj0YabOIE3DlW0qVHtU5XLA",
      authDomain: "hamsasarees-24738.firebaseapp.com",
      projectId: "hamsasarees-24738",
      storageBucket: "hamsasarees-24738.firebasestorage.app",
      messagingSenderId: "16303342424",
      appId: "1:16303342424:web:d68d26160d45472713db2d",
      measurementId: "G-1G1HQGJ5XS"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();

    // Dom refs
    const loginModal = document.getElementById('loginModal');
    const myOrdersModal = document.getElementById('myOrdersModal');
    const orderModal = document.getElementById('orderModal');
    const paymentModal = document.getElementById('paymentModal');
    const loginErr = document.getElementById('loginErr');
    const loginShowBtn = document.getElementById('loginShowBtn');
    const googleBtnLarge = document.getElementById('googleBtnLarge');
    const userBadge = document.getElementById('userBadge');
    const signOutBtn = document.getElementById('signOutBtn');
    const myOrdersBtn = document.getElementById('myOrdersBtn');
    const ordersList = document.getElementById('ordersList');

    function showLoginError(msg){ if(loginErr){ loginErr.innerText = msg; loginErr.style.display = msg ? 'block' : 'none'; } }
    function toast(msg){ const t=document.getElementById('toast'); if(!t) return; t.innerText=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2000); }

    try{ const rr = await getRedirectResult(auth); if(rr && rr.user) console.log('redirect result user', rr.user.uid); }catch(e){ console.warn('redirect result error', e && e.code); }

    async function signInWithProviderPopup(provider){ showLoginError(''); try{ const res = await signInWithPopup(auth, provider); toast('Signed in'); console.log('signed-in', res.user.uid); }catch(e){ console.error('popup error', e && e.code, e && e.message); const popupErrors = ['auth/popup-blocked','auth/popup-closed-by-user','auth/cancelled-popup-request']; if(e && popupErrors.includes(e.code)){ try{ await signInWithRedirect(auth, provider); return; }catch(err){ showLoginError('Popup blocked and redirect failed. Allow popups or try another browser.'); return; } } if(e && e.code === 'auth/unauthorized-domain'){ showLoginError('Domain not authorized. Add your GitHub Pages domain in Firebase console → Authentication → Authorized domains.'); } else{ showLoginError(e && e.message ? e.message : 'Sign-in failed'); } } }

    googleBtnLarge && googleBtnLarge.addEventListener('click', () => signInWithProviderPopup(googleProvider));
    loginShowBtn && loginShowBtn.addEventListener('click', () => { if(loginModal) loginModal.style.display = 'flex'; });
    signOutBtn && signOutBtn.addEventListener('click', async () => { try{ await signOut(auth); toast('Signed out'); }catch(e){ console.error('signout failed', e); } });

    // product order buttons
    document.querySelectorAll('.orderBtn').forEach(btn => btn.addEventListener('click', (ev) => {
      const prod = ev.currentTarget.getAttribute('data-product');
      if(!auth.currentUser){ if(loginModal) loginModal.style.display = 'flex'; showLoginError('Please sign in with Google to place orders'); return; }
      document.getElementById('selectedProduct').innerText = prod;
      document.getElementById('productField').value = prod;
      if(orderModal) orderModal.style.display = 'flex';
    }));

    document.getElementById('cancelOrder').addEventListener('click', ()=>{ if(orderModal) orderModal.style.display='none'; });
    document.getElementById('closeOrderModal').addEventListener('click', ()=>{ if(orderModal) orderModal.style.display='none'; });
    document.getElementById('closeLogin').addEventListener('click', ()=>{ if(loginModal) loginModal.style.display='none'; });
    document.getElementById('closePayment').addEventListener('click', ()=>{ if(paymentModal) paymentModal.style.display='none'; });
    document.getElementById('closeMyOrdersX').addEventListener('click', ()=>{ if(myOrdersModal) myOrdersModal.style.display='none'; });

    // Place order -> open payment modal with pendingOrder
    document.getElementById('placeOrder').addEventListener('click', async (ev)=>{
      ev.preventDefault();
      const name = document.getElementById('custName').value.trim();
      const address = document.getElementById('custAddress').value.trim();
      const phone = document.getElementById('custPhone').value.trim();
      const product = document.getElementById('productField').value;
      if(!name || !address || !phone){ alert('Fill all fields'); return; }

      window.pendingOrder = { product, name, address, phone };
      try{ document.getElementById('orderForm').submit(); }catch(e){ console.warn('form.submit failed', e); }
      if(orderModal) orderModal.style.display='none';
      const paymentSummary = document.getElementById('paymentSummary'); if(paymentSummary) paymentSummary.innerText = `${product} — ₹ (check price)
Name: ${name}
Phone: ${phone}`;
      if(paymentModal) paymentModal.style.display='flex';
    });

    // Pay Now handler
    document.getElementById('payNow').addEventListener('click', async ()=>{
      const payMsg = document.getElementById('paymentMsg'); if(payMsg) payMsg.style.display = 'block';
      const payNowBtn = document.getElementById('payNow'); if(payNowBtn) payNowBtn.disabled = true;
      setTimeout(async ()=>{
        try{
          const uid = auth.currentUser ? auth.currentUser.uid : null;
          const orderData = { ...(window.pendingOrder||{}), user: uid, userEmail: auth.currentUser ? auth.currentUser.email : null, createdAt: serverTimestamp() };
          if(uid){ await addDoc(collection(db, `users/${uid}/orders`), orderData); }
          await addDoc(collection(db, 'orders'), orderData);
          if(payMsg) payMsg.style.display = 'none';
          document.getElementById('orderStatus').innerText = 'Order placed and payment received. Thank you!';
          document.getElementById('orderStatus').style.display = 'block';
          setTimeout(()=>{ if(paymentModal) paymentModal.style.display='none'; document.getElementById('orderStatus').style.display='none'; document.getElementById('orderForm').reset(); window.pendingOrder = null; }, 1400);
          toast('Order successful');
        }catch(e){ console.error('save order after payment failed', e); showLoginError('Payment succeeded but saving order failed. Check console.'); }
      },900);
    });

    // My Orders fetch
    myOrdersBtn && myOrdersBtn.addEventListener('click', async ()=>{
      if(!auth.currentUser){ if(loginModal) loginModal.style.display='flex'; showLoginError('Please sign in to view your orders'); return; }
      ordersList.innerHTML = '<div class="small">Loading...</div>';
      try{
        const uid = auth.currentUser.uid;
        const q = query(collection(db, `users/${uid}/orders`), orderBy('createdAt','desc'));
        const snap = await getDocs(q);
        if(snap.empty){ ordersList.innerHTML = '<div class="small">No orders yet</div>'; } else {
          ordersList.innerHTML = '';
          snap.forEach(doc => {
            const o = doc.data();
            const el = document.createElement('div');
            el.style.padding='10px'; el.style.borderBottom='1px solid rgba(255,255,255,0.03)';
            el.innerHTML = `<strong style="color:#fff">${o.product||''}</strong><div class='small'>${o.name||''} • ${o.phone||''}</div><div class='small'>${o.address||''}</div><div class='small' style='color:var(--muted)'>${o.createdAt ? new Date(o.createdAt.seconds*1000).toLocaleString() : ''}</div>`;
            ordersList.appendChild(el);
          });
        }
        if(myOrdersModal) myOrdersModal.style.display='flex';
      }catch(e){ console.error('fetch orders failed', e); ordersList.innerHTML = '<div class="small">Failed to load orders</div>'; }
    });

    // auth state
    onAuthStateChanged(auth, (user)=>{
      if(user){ if(loginModal) loginModal.style.display='none'; if(userBadge){ userBadge.style.display='inline-block'; userBadge.innerText = user.displayName || user.email; } if(signOutBtn) signOutBtn.style.display='inline-block'; if(myOrdersBtn) myOrdersBtn.style.display='inline-block'; loginShowBtn.style.display='none'; } else { if(loginModal) loginModal.style.display='flex'; if(userBadge) userBadge.style.display='none'; if(signOutBtn) signOutBtn.style.display='none'; if(myOrdersBtn) myOrdersBtn.style.display='none'; loginShowBtn.style.display='inline-block'; } });

    document.getElementById('shopNow').addEventListener('click', ()=>{ document.getElementById('productGrid').scrollIntoView({behavior:'smooth'}); });

    // extra small UX: search filter
    document.getElementById('searchBox').addEventListener('input', (e)=>{
      const v = e.target.value.toLowerCase();
      document.querySelectorAll('.card').forEach(card=>{ const t = card.querySelector('h3').innerText.toLowerCase(); card.style.display = t.includes(v) ? 'block' : 'none'; });
    });

    // ensure modals have close buttons accessible
    ['closeOrderModal','closeLogin','closePayment','closeMyOrdersX','closeOrders'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('click', ()=>{ const modal = el.closest('.modal'); if(modal) modal.style.display='none'; }); });

    // initial UI
    if(!auth.currentUser){ if(loginModal) loginModal.style.display='flex'; }

  }catch(err){ console.error('Init error', err); const le = document.getElementById('loginErr'); if(le){ le.innerText='Initialization error. See console.'; le.style.display='block'; } }
});
</script>
</body>
</html>
