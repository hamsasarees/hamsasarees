<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hamsa Sarees — Single Page (Admin + Edit/Delete + Ratings + Orders)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{--bg1:#001f3f;--bg2:#00306b;--accent:#00aaff;--accent2:#4dd0e1;--muted:#9fb8d9;--success:#10b981}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#eaf6ff}
  .container{max-width:1100px;margin:20px auto;padding:0 16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:16px}
  .card{background:linear-gradient(180deg,#071522,#06121a);padding:12px;border-radius:12px;position:relative}
  .imgwrap{height:180px;border-radius:10px;overflow:hidden}
  .imgwrap img{width:100%;height:100%;object-fit:cover}
  .btn{cursor:pointer;border-radius:8px;padding:8px 12px;border:none;background:#0184ff;color:#fff}
  .btn-ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px}
  .admin-only{display:none}
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1200}
  .modal.show{display:flex}
  .modal-box{background:#071522;padding:16px;border-radius:10px;color:#eaf6ff;max-width:720px;width:100%}
  .close-x{float:right;background:transparent;border:none;color:#ff7b7b;font-weight:800;font-size:18px}
  .small{color:#9fb8d9}
  .toast{position:fixed;right:16px;bottom:16px;background:#0b1220;padding:10px 14px;border-radius:10px;color:#d1fae5;border-left:4px solid var(--success);display:none}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="logo">HS</div>
        <div>
          <div style="font-weight:800">Hamsa Sarees</div>
          <div class="small">Admin demo: Add / Edit / Delete products</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div id="userBadge" style="display:none;background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:8px"></div>
        <button id="loginShowBtn" class="btn">Sign in</button>
        <button id="signOutBtn" class="btn-ghost" style="display:none">Sign out</button>
      </div>
    </header>

    <main>
      <section>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2 style="margin:0">Products</h2>
          <div>
            <button id="openAdminBtn" class="btn admin-only" style="display:none">Admin</button>
          </div>
        </div>

        <div class="grid" id="productGrid">
          <div class="card" style="grid-column:1/-1;text-align:center;color:var(--muted);padding:32px;background:transparent">
            <strong style="color:#eaf6ff">No products yet</strong>
            <div class="small" style="margin-top:8px">As admin you can add products using the Admin modal below.</div>
            <div style="margin-top:12px"><button id="openAdminFromEmpty" class="btn-ghost">Open Admin</button></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Admin modal (Add/Edit) -->
  <div class="modal" id="adminModal" aria-hidden="true">
    <div class="modal-box">
      <button class="close-x" id="closeAdmin">✕</button>
      <h3 id="adminModalTitle">Add Product</h3>
      <div class="field"><label class="small">Title</label><input id="admin_pTitle" placeholder="Product title" style="width:100%;padding:8px;border-radius:6px;background:#08121a;border:none;color:#eaf6ff"/></div>
      <div class="field"><label class="small">Price (₹)</label><input id="admin_pPrice" type="number" placeholder="1499" style="width:120px;padding:8px;border-radius:6px;background:#08121a;border:none;color:#eaf6ff"/></div>
      <div class="field"><label class="small">Tag</label><input id="admin_pTag" placeholder="e.g. New" style="width:200px;padding:8px;border-radius:6px;background:#08121a;border:none;color:#eaf6ff"/></div>
      <div class="field"><label class="small">Image URL</label><input id="admin_pImg" placeholder="https://..." style="width:100%;padding:8px;border-radius:6px;background:#08121a;border:none;color:#eaf6ff"/></div>
      <div id="imgPreviewWrap" style="margin-top:12px;display:none"><img id="imgPreview" alt="preview" style="max-width:160px;border-radius:6px;display:block;"/></div>
      <input type="hidden" id="admin_editId" />
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="adminSave" class="btn">Save</button>
        <button id="adminCancel" class="btn-ghost">Cancel</button>
        <button id="adminDelete" class="btn-ghost" style="display:none;background:#7a1515;color:#fff;border:none">Delete</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">Saved.</div>

<script type="module">
(async ()=>{
  // minimal Firebase imports — same as canvas version
  const firebaseConfig = {
    apiKey: "AIzaSyBozW19Rjc9nj0YabOIE3DlW0qVHtU5XLA",
    authDomain: "hamsasarees-24738.firebaseapp.com",
    projectId: "hamsasarees-24738",
    storageBucket: "hamsasarees-24738.firebasestorage.app",
    messagingSenderId: "16303342424",
    appId: "1:16303342424:web:d68d26160d45472713db2d",
  };

  const ADMIN_UID = 'EenXHJIvZpavhkGTCI8EZyFAfH93';
  const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
  const authMod = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
  const fsMod = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
  const { getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult, signOut, onAuthStateChanged } = authMod;
  const { getFirestore, collection, addDoc, setDoc, doc, deleteDoc, serverTimestamp, query, orderBy, getDocs, onSnapshot, updateDoc, getDoc } = fsMod;

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const googleProvider = new GoogleAuthProvider();

  const $ = id => document.getElementById(id);
  const productGrid = $('productGrid');
  const adminModal = $('adminModal');

  function toast(msg){ const t = $('toast'); if(!t) return; t.innerText = msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1400); }
  function openModal(m){ if(!m) return; m.classList.add('show'); m.removeAttribute('aria-hidden'); document.body.style.overflow='hidden'; }
  function closeModal(m){ if(!m) return; m.classList.remove('show'); m.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

  // simple render for product card
  function renderProductCard(docId, data){
    const el = document.createElement('div'); el.className='card'; el.dataset.docid = docId;
    el.innerHTML = `
      <div class="imgwrap"><img src="${data.img||'https://images.unsplash.com/photo-1520975918016-4d0b5b0b2f3d?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder'}" alt="${(data.title||'')}"></div>
      <h3 style="margin:10px 0">${data.title||'Untitled'}</h3>
      <div style="display:flex;justify-content:space-between;align-items:center"><div style="font-weight:700">₹${data.price||0}</div><div class="small">${data.tag||''}</div></div>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:space-between;align-items:center">
        <div><button class="orderBtn btn" data-product="${(data.title||'')}">Order</button></div>
        <div style="display:flex;gap:8px">
          <button class="btn-ghost admin-edit admin-only" data-docid="${docId}" style="display:none">Edit</button>
          <button class="btn admin-del admin-only" data-docid="${docId}" style="display:none;background:#7a1515">Delete</button>
        </div>
      </div>
    `;
    return el;
  }

  // live product listener
  const productsCol = collection(db,'products');
  onSnapshot(productsCol, snap=>{
    productGrid.innerHTML='';
    if(snap.empty){ productGrid.innerHTML = `<div class="card" style="grid-column:1/-1;text-align:center;color:var(--muted);padding:32px;background:transparent"><strong style="color:#eaf6ff">No products yet</strong><div class="small" style="margin-top:8px">Use admin to add products.</div><div style="margin-top:12px"><button id="openAdminFromEmpty" class="btn-ghost">Open Admin</button></div></div>`; document.getElementById('openAdminFromEmpty')?.addEventListener('click', ()=>{ openModal(adminModal); }); return; }
    snap.forEach(d=>{ const card = renderProductCard(d.id, d.data()); productGrid.appendChild(card); });
    refreshAdminControls();
  }, err=>{ console.error(err); productGrid.innerHTML='<div class="small">Failed to load products</div>'; });

  // delegation for edit/delete/order
  productGrid.addEventListener('click', async ev=>{
    const edit = ev.target.closest('.admin-edit'); if(edit){ const id = edit.dataset.docid; if(!id) return; if(!auth.currentUser || auth.currentUser.uid !== ADMIN_UID){ alert('Only admin'); return; } const snap = await getDoc(doc(db,'products',id)); if(!snap.exists()){ alert('Product missing'); return; } const data = snap.data(); $('admin_pTitle').value = data.title||''; $('admin_pPrice').value = data.price||''; $('admin_pTag').value = data.tag||''; $('admin_pImg').value = data.img||''; $('admin_editId').value = id; $('adminModalTitle').innerText='Edit Product'; $('adminDelete').style.display='inline-block'; updateImagePreview(); openModal(adminModal); return; }
    const del = ev.target.closest('.admin-del'); if(del){ const id = del.dataset.docid; if(!id) return; if(!auth.currentUser || auth.currentUser.uid !== ADMIN_UID){ alert('Only admin'); return; } const ok = confirm('Delete product?'); if(!ok) return; await deleteDoc(doc(db,'products',id)); toast('Deleted'); return; }
    const order = ev.target.closest('.orderBtn'); if(order){ const p = order.dataset.product||''; alert('Order flow — product: '+p); }
  });

  // admin modal helpers
  function updateImagePreview(){ const url = $('admin_pImg').value.trim(); const wrap = $('imgPreviewWrap'); const img = $('imgPreview'); if(!url){ wrap.style.display='none'; img.src=''; return; } img.onload = ()=>wrap.style.display='block'; img.onerror = ()=>wrap.style.display='none'; img.src = url; }
  $('admin_pImg').addEventListener('input', updateImagePreview);

  // save product (create or update)
  $('adminSave').addEventListener('click', async ()=>{
    const title = $('admin_pTitle').value.trim(); const price = Number($('admin_pPrice').value.trim()); const tag = $('admin_pTag').value.trim(); const img = $('admin_pImg').value.trim(); const editId = $('admin_editId').value.trim();
    if(!title||!price){ alert('Title and price required'); return; }
    if(!auth.currentUser || auth.currentUser.uid !== ADMIN_UID){ alert('Only admin'); return; }
    try{
      const payload = { title, price, tag, img, updatedAt: serverTimestamp() };
      if(editId){ await updateDoc(doc(db,'products',editId), payload); toast('Updated'); }
      else { payload.createdAt = serverTimestamp(); await addDoc(collection(db,'products'), payload); toast('Added'); }
      closeModal(adminModal); $('admin_editId').value='';
    }catch(e){ console.error(e); alert('Failed to save'); }
  });

  $('adminDelete').addEventListener('click', async ()=>{
    const id = $('admin_editId').value.trim(); if(!id) return; const ok = confirm('Delete product permanently?'); if(!ok) return; try{ await deleteDoc(doc(db,'products',id)); toast('Deleted'); closeModal(adminModal); }catch(e){ console.error(e); alert('Delete failed'); }
  });

  $('adminCancel').addEventListener('click', ()=>{ closeModal(adminModal); });
  $('closeAdmin').addEventListener('click', ()=>{ closeModal(adminModal); });

  // auth quick demo (Google)
  $('loginShowBtn').addEventListener('click', async ()=>{ try{ await signInWithPopup(auth, googleProvider); }catch(e){ try{ await signInWithRedirect(auth, googleProvider); }catch(err){ alert('Sign-in failed'); } } });
  $('signOutBtn').addEventListener('click', async ()=>{ await signOut(auth); });

  function refreshAdminControls(){ document.querySelectorAll('.admin-only').forEach(el=> el.style.display = (auth.currentUser && auth.currentUser.uid === ADMIN_UID) ? 'inline-block' : 'none'); }

  onAuthStateChanged(auth, user=>{
    if(user){ $('userBadge').style.display='inline-block'; $('userBadge').innerText = user.displayName || user.email; $('loginShowBtn').style.display='none'; $('signOutBtn').style.display='inline-block'; refreshAdminControls(); }
    else{ $('userBadge').style.display='none'; $('loginShowBtn').style.display='inline-block'; $('signOutBtn').style.display='none'; refreshAdminControls(); }
  });

})();
</script>
</body>
</html>
